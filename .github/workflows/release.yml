name: release-program
run-name: ${{ github.actor }} has executed the action
on:
  push:
    tags: 
      - '*/v[0-9].[0-9].[0-9]*'

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Get and check Tag
        run: |
          echo "Tag name from GITHUB_REF_NAME: $GITHUB_REF_NAME "
          string="$GITHUB_REF_NAME"
          if [[ $GITHUB_REF_NAME =~ .*"CLI".* ]]; then
            echo "plattform=CLI" >> $GITHUB_ENV
            echo "github_version=${string:4}" >> $GITHUB_ENV
          elif [[ $GITHUB_REF_NAME =~ .*"BOTH".* ]]; then
            echo "plattform=BOTH" >> $GITHUB_ENV
            echo "github_version=${string:5}" >> $GITHUB_ENV
          elif [[ $GITHUB_REF_NAME =~ .*"UI".* ]]; then
            echo "plattform=UI" >> $GITHUB_ENV
            echo "github_version=${string:3}" >> $GITHUB_ENV
          else
            exit 1
          fi

      - name: Build Console
        if: ${{ env.plattform == 'CLI' }}
        run: |
          echo "Plattform is CLI - Running MSBuild to build and restore console..."
          dotnet msbuild LivingTimeConverterConsole/LivingTimeConverterConsole/LivingTimeConverterConsole.csproj -r
          dotnet msbuild LivingTimeConverterConsole/LivingTimeConverterConsole/LivingTimeConverterConsole.csproj -property:Configuration=Release
          cd LivingTimeConverterConsole/LivingTimeConverterConsole/
          ls

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: "${{ env.github_version }}"
          generate_release_notes: true
          files: LivingTimeConverterConsole/LivingTimeConverterConsole/bin/Release/net6.0/LivingTimeConverterConsole.exe
        env:
          GITHUB_TOKEN: ${{ github.token }}



